package com.yandexmobileads

import com.facebook.react.bridge.Promise
import com.facebook.react.bridge.ReactApplicationContext
import com.facebook.react.bridge.ReactContextBaseJavaModule
import com.facebook.react.bridge.ReactMethod
import com.yandex.mobile.ads.common.MobileAds
import com.yandexmobileads.common.Constants

class YandexMobileAdsModule(
    private val reactContext: ReactApplicationContext,
) : ReactContextBaseJavaModule(reactContext) {
    override fun getName(): String = NAME

    @ReactMethod
    fun getLibraryVersion(promise: Promise) {
        val libraryVersion = MobileAds.libraryVersion
        promise.resolve(libraryVersion)
    }

    @ReactMethod
    fun showDebugPanel(promise: Promise) {
        currentActivity?.let { activity ->
            activity.runOnUiThread {
                MobileAds.showDebugPanel(activity)
                promise.resolve(null)
            }
        } ?: promise.reject(
            Constants.Error.CODE_INTERNAL_ERROR,
            Constants.Error.MESSAGE_NULL_ACTIVITY
        )
    }

    @ReactMethod
    fun enableDebugErrorIndicator(enableIndicator: Boolean) {
        MobileAds.enableDebugErrorIndicator(enableIndicator)
    }

    @ReactMethod
    fun enableLogging(enableLogging: Boolean) {
        MobileAds.enableLogging(enableLogging)
    }

    @ReactMethod
    fun setLocationConsent(locationConsent: Boolean) {
        MobileAds.setLocationConsent(locationConsent)
    }

    @ReactMethod
    fun setAgeRestrictedUser(ageRestrictedUser: Boolean) {
        MobileAds.setAgeRestrictedUser(ageRestrictedUser)
    }

    @ReactMethod
    fun setUserConsent(consent: Boolean) {
        MobileAds.setUserConsent(consent)
    }

    @ReactMethod
    fun initializeSdk(promise: Promise) {
        MobileAds.initialize(reactContext) {
            promise.resolve(null)
        }
    }

    companion object {
        const val NAME = "YandexMobileAds"
    }
}
